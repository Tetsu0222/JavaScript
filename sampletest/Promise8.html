<!DOCTYPE html>
<html>

    <body>

        <script>

            //---ジョブキューとタスクキュー、マイクロタスク

            //コールスタックが空になった場合、タスクキューとジョブキューのそれぞれにタスクとジョブが格納されている場合
            //ジョブキューのジョブがすべて実行され、コールスタックが空になった後、タスクキューのタスクが実行される。

            console.log( "A" );

            setTimeout( () => {
                queueMicrotask( () => console.log( "B" ) );     //非同期処理の中で、さらに非同期処理で扱われている場合、処理が後続になる。
                console.log( "C" );
            } );

            Promise.resolve().then( () => console.log( "D" ));

            console.log( "E" );


            // A E D C B　の順番で出力される。

            
            //同期処理のAとEがコールスタックに積みあがるため、まずはAとEが出力される。

            //次にコールスタックが空になるため、イベントループがジョブキューを検知する。

            //Promiseによる非同期処理は、タスクキューではなく、ジョブキューに積みあがる。
            //そのため、タスクキューに登録されているBとCよりも、Dが先に実行される。

            //再びコールスタックが空になるため、イベントループがBとCを検知

            //通常の非同期処理により、BとCの処理がタスクキューに追加される。
            //その中で、さらにBの処理が非同期的に実行されるため、先にCの処理が実行される。

            //コールスタックが空になるため、イベントループがBを検知

            //Bが出力される。


        </script>
        
    </body>

</html>