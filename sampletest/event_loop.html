<!DOCTYPE html>
<html>

    <body>

        <script>
            //JSコードの実行開始
            //コードを実行する前に、グローバルコンテキストがコールスタックに積まれる。
            //つまり、メインスレッドがグローバルコンテキストによって使用中の状態となる。

            let val = 0;

            setTimeout( function task() {   //タスクの登録
                val = 1;                    //0秒後、変数valを1に変更する。この処理は非同期で実行される。
            } , 0 );

            //setTimoutを通して、コールバック関数(task)がタスクキューに実行待ちの状態で登録される。
            //タスクキューに登録された関数taskは、コールスタックが空になるまで実行されないため、タスクキューで実行待ちの状態で待機している。
            //その実行待機状態は、現在実行中のコンテキストであるグローバルコンテキストのコードがすべて完了し、コールスタックが空になるまで。

            console.log( val );             //「0」が出力される。
            
            
            //setTimeoutは即時実行（0秒）で指定しているが
            //console.logの時点で、ブラウザとJSは非同期なため、ブラウザのAPIのsetTimeoutの処理結果を取得できていない。
            //厳密には、このコードが実行される時点で、タスクキューに置かれている関数taskは実行されていない。


            //最後までコードが達すると、コールスタック上のグローバルコンテキストが消滅
            //同時に、コールスタックが空の状態となる。

            //コールスタックが空になると、イベントループがそれを検知する。
            //実行待ちのtask関数をタスクキューから取得して実行する。
            //また、task関数の実行に伴い、関数コンテキストが新たに生成される。


        </script>
        
    </body>

</html>