<!DOCTYPE html>
<html>

    <body>

        <script>

            let val = -1;

            //非同期処理での値の変更
            function timer( callback ){
                setTimeout( function task() {
                    val = Math.floor( Math.random() * 11 );
                    callback( val ); //コールバック関数に引数valを渡して実行
                } , 1000 );
            }

            //非同期処理の実行後に、後続で実行したい処理を関数内に記述
            function operations( val ){
                console.log( val );
            }

            function operations2( val ){
                alert( val * 10 );
            }

            //コールバック関数としてtimer()に渡す。
            timer( operations );        //ここでクロージャが生成される。この時点で使える変数(処理結果後のval含む)を保持している。
            timer( operations2 );       //さらにクロージャが生成される。上記とは別のクロージャであり、この時点で扱える変数を同じように保持している。



            //コンソールで出力されるのは、初期値の「-1」ではなく、非同期処理で変更された値が出力される。
            //非同期処理の後で行いたい処理をコールバック関数内にまとめることで、
            //上記のコードで言えば、setTimeputの後に特定の処理を実行できるようになっている（非同期処理の結果を受け取れる）

            //関数とそれを使用できる変数をセットにしたものをクロージャと呼ぶ。
            //このクロージャ（関数オブジェクト）がコールバック関数の実態である。
            

            //クロージャ生成時点で、変数だけを保持しており、厳密には処理は実行されていない。
            


        </script>
        
    </body>

</html>